<!DOCTYPE html>
<html>


<!--

TODO: 

- Remove my onePost Gocky code and replace it with a filter function that filters posts by date and sorts them in descending order.
- Create a read only version by hiding the controls


- Deploy a version to cloudflare - works as needed

- Deployed version will not download ( not urgent to fix )



-->



<head>
  <title>Blogging For Fun</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://www.w3schools.com/w3css/5/w3.css">
  <link rel="stylesheet" href="https://www.w3schools.com/lib/w3-theme-blue-grey.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <style>
    html,
    body,
    h1,
    h2,
    h3,
    h4,
    h5 {
      font-family: "Roboto", sans-serif;
      font-weight: 400;
    }

    h1 {
      font-size: 60px;
    }


    table,
    th,
    td {
      border: 2px solid black;
      padding: 0px;
    }

    table {
      border-collapse: collapse;
    }

    td:nth-child(2),
    th:nth-child(2),
    td:nth-child(3),
    th:nth-child(3) {
      padding: 2px;
    }

    td:nth-child(3),
    th:nth-child(3) {
      padding: 2px;
      text-align: center;
    }


    .w3-col.m7 {

      /* Adjust height as needed */
      height: 800px;
      overflow-y: auto;

      /* Enable vertical scrolling */
    }

    .post-header {
      height: 280px;
      background-color: #f1f1f1;
      border-radius: 20px;
      padding: 10px;
      margin-bottom: 10px;
    }

    .post-container {

      overflow-y: auto;
      /* Enable vertical scrolling */
      font-size: 18px;
      /* Adjust font size as needed */

      width: 100%
    }

    .input-form {
      display: none;
      /* Hide the form initially */
    }

    .hidden {
      display: none;
    }






    .alert {
      position: fixed;
      top: 20%;
      /* Center vertically */
      left: 50%;
      /* Center horizontally */
      transform: translate(-50%, -50%);
      /* Adjust for the element's size */
      background-color: beige;
      /* Red background */
      color: white;
      padding: 15px;
      border-radius: 5px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      z-index: 1000;
      font-size: larger;
      color: black;
      text-align: center;
      /* Center the text inside the alert */
      width: 300px;
      padding-top: 30px; 
      padding-bottom: 30px;  
      /* Optional: Set a fixed width */
      transition: opacity 2.0s ease-in-out;
    }

    .alert-success {
      background-color: beige;
      /* Green */
    }

    .alert-warning {
      background-color: #ff9800;
      /* Orange */
    }

    .alert-error {
      background-color: #f44336;
      /* Red */
    }
  </style>

  <script src="content.js"></script>



  <script>

    const readOnly = false;
    const onePost = true; // Set to true to show only one post at a time

    window.onload = function () {
      renderPosts();
      generateSideMenu();
    };




    function showAlert(message, type = "alert-error", duration = 3000) {
      const alertBox = document.getElementById("custom-alert");
      const alertMessage = document.getElementById("alert-message");

      // Set the message and type
      alertMessage.textContent = message;
      alertBox.className = `alert ${type}`;
      alertBox.style.display = "block";

      

  // Add a click event listener to the document
  const closeAlertOnClick = (event) => {
    // Check if the click is outside the alert box
    if (!alertBox.contains(event.target)) {
      alertBox.style.display = "none"; // Hide the alert
      document.removeEventListener("click", closeAlertOnClick); // Remove the event listener
    }
  };

  document.addEventListener("click", closeAlertOnClick);

  // Optionally, hide the alert after a duration
  setTimeout(() => {
    alertBox.style.display = "none";
    document.removeEventListener("click", closeAlertOnClick); // Remove the event listener
  }, duration);








    }



    // doesn't write out posts 
    function generateSideMenu() {

      //   if (readOnly) {
      //    const adminElements = document.getElementsByClassName("admin");
      //      Array.from(adminElements).forEach((element) => {
      //       element.style.display = "none";
      //    });
      //     }
      //
      const sideMenu = document.getElementById("side-menu");
      sideMenu.innerHTML = "";

      if (readOnly)
        var posts = postsContent;
      else
        var posts = CRUD.getAllPosts();

      posts.forEach((post) => {
        const menuItem = document.createElement("button");
        menuItem.className = "w3-button w3-block w3-theme-l4";
        menuItem.style.marginBottom = "5px";
        menuItem.style.display = "flex"; // Align image and text horizontally
        menuItem.style.alignItems = "center"; // Center-align image and text

        // Add an image to the button
        const img = document.createElement("img");
        img.src = `images/${post.image}`; // Use the post's image
        img.alt = post.headline;
        img.style.width = "30px"; // Set image size
        img.style.height = "30px";
        img.style.marginRight = "10px"; // Add spacing between image and text

        // Add text to the button
        const text = document.createTextNode(post.headline || "Untitled Post");

        // Append image and text to the button
        menuItem.appendChild(img);
        menuItem.appendChild(text);

        // Add click functionality
        menuItem.onclick = () => {


          const targetPost = document.getElementById(post.key);
          const middleColumn = document.querySelector(".w3-col.m7");


          //  remove this code and replace it with a filter function 

          if (onePost) {
            document.querySelectorAll(".post").forEach((post) => {
              post.style.display = "none";
            });
            // show the one with post.key
            targetPost.style.display = "block";
          }


          if (targetPost && middleColumn) {
            middleColumn.scrollTo({
              top: targetPost.offsetTop - middleColumn.offsetTop,
              behavior: "smooth",
            });
          }

        };

        sideMenu.appendChild(menuItem);
      });
    }


    // does read more, read less
    function togglePost() {
      const thisButton = this;
      const post = thisButton.closest(".post");
      const content = post.querySelector(".content");
      if (content.style.display === "none" || !content.style.display) {
        content.style.display = "block";
        thisButton.textContent = "Read Less";
      } else {
        content.style.display = "none";
        thisButton.textContent = "Read More";
      }
    }


    // CRUD operations for posts using localStorage

    class CRUD {
      static createPost(key, value) {
        try {
          localStorage.setItem(key, JSON.stringify(value));
        } catch (e) {
          console.error("Error saving post:", e);
        }
      }

      static retrievePost(key) {
        try {
          const data = localStorage.getItem(key);
          return data ? JSON.parse(data) : null;
        } catch (e) {
          console.error("Error retrieving post:", e);
          return null;
        }
      }

      static updatePost(key, value) {
        this.createPost(key, value);
      }

      static deletePost(key) {
        try {
          localStorage.removeItem(key);
        } catch (e) {
          console.error("Error deleting post:", e);
        }
      }

      static getAllPosts() {
        const posts = [];
        for (let i = 0; i < localStorage.length; i++) {
          const key = localStorage.key(i);
          if (key.startsWith("post-") || true) {
            const post = this.retrievePost(key);
            if (post) posts.push(post);
          }
        }
        return posts.sort((a, b) => new Date(b.date) - new Date(a.date));
      }

      static deleteAllPosts() {
        localStorage.clear();
        alert("All posts have been deleted.");






      }
    }

    // to show the posts on page load on the main page
    function renderPosts() {
      const postContainer = document.querySelector(".post-container");
      if (!postContainer) {
        console.error("post-container not found");
        return;
      }

      if (readOnly)
        var posts = postsContent; // from content.js
      else
        var posts = CRUD.getAllPosts();

      // would be good to have a filter function here to filter and sort posts

      // write code to filter posts by date and sort them in descending order

      posts.forEach((post) => {
        const postElement = document.createElement("div");
        postElement.id = post.key;
        postElement.className = "post";
        postElement.style.cssText = "background-color:beige; padding: 12px; margin-bottom: 10px;";
        postElement.innerHTML = `
      <div class="w3-card-4 post-header" style="width:100%;margin-bottom:20px;border-radius: 5px; ">
        <header class="w3-container w3-light-grey" style="padding:0px;">
          <h3>${post.headline}</h3>
        </header>
        <div class="w3-container">
          <img src="images/${post.image}" alt="Image for ${post.headline}" class="w3-left w3-margin-right" style="max-width:150px;max-height:150px;margin-bottom:10px">
          <p>${post.teaser}</p><br>
          <div class="w3-right w3-margin-top">
        
          </div>
        </div>
        <div style="height:40px;style="background-color: pink;">


    <button class="admin" style="margin-left:20px" onclick="editPost('${post.key}')">Edit</button>
            <button class="admin" onclick="deletePost('${post.key}')">Delete</button>
          <button style="float:right;margin-top: 0px;margin-right:10px" 
          onclick="togglePost.call(this)" aria-label="Toggle post content">Read More</button>
        </div>
      </div>
      <div class="content w3-justify" style="display:none">${post.content}</div>
    `;
        postContainer.appendChild(postElement);
      });

      //      alert(posts.length + " posts loaded.");


      showAlert(posts.length + " posts loaded", "alert-success", 5000); // Closes after 5 seconds


      generateSideMenu();
    }


    function setupPostForm() {

      const formContainer = document.querySelector(".input-form");
      if (formContainer) {
        formContainer.style.display = "block"; // Show the form


        // Scroll the form into view
        formContainer.scrollIntoView({
          behavior: "smooth", // Smooth scrolling
          block: "start", // Align to the top of the block
        });

      }

      // Reset the form fields for creating a new post
      const form = document.getElementById("new-post-form");
      if (!form.dataset.editing) {
        form.reset(); // Reset the form only if not editing
        document.getElementById("post-key").value = Date.now(); // Generate a new unique key


        const postType = document.getElementById("editType");
        postType.innerHTML = "Create Post";


      }


      form.onsubmit = (e) => {
        e.preventDefault();
        console.log("Form submitted!"); // Debugging statement
        const key = document.getElementById("post-key").value;
        const error = document.getElementById("post-key-error");

        // Check for duplicate keys only when creating a new post
        if (!form.dataset.editing && CRUD.retrievePost(key)) {
          error.style.display = "block";
          return;
        }
        error.style.display = "none";

        const post = {
          key: document.getElementById("post-key").value,
          headline: document.getElementById("post-headlinex").value,
          teaser: document.getElementById("post-teaser").value,
          content: document.getElementById("post-content").value,


          image: document.getElementById("post-imagex").files[0]
            ? document.getElementById("post-imagex").files[0].name
            : document.getElementById("current-image").textContent.replace("Current Image: ", ""),





          date: document.getElementById("post-date").value || new Date().toISOString().split("T")[0],
        };

        if (form.dataset.editing) {
          // Update the existing post
          CRUD.updatePost(post.key, post);
        } else {
          // Create a new post
          if (post.key == "")
            alert("Key is empty. Please enter a valid key.");
          else {
            alert("new post");
            CRUD.createPost(post.key, post);
          }
        }

        renderPosts(); // Re-render the posts
        form.reset(); // Reset the form
        form.dataset.editing = ""; // Clear editing mode
        formContainer.style.display = "none"; // Hide the form
      };
    }


    function editPost(postKey) {



      const post = CRUD.retrievePost(postKey); // Retrieve the post data
      if (post) {
        const formContainer = document.querySelector(".input-form");
        if (formContainer) {
          formContainer.style.display = "block"; // Show the form

          // Scroll the form into view
          formContainer.scrollIntoView({
            behavior: "smooth", // Smooth scrolling
            block: "start", // Align to the top of the block
          });

          const editType = document.getElementById("editType");
          editType.innerHTML = "Edit Post"; // Change the form title to "Edit Post"



        }

        // Populate the form fields with the post's data
        document.getElementById("post-key").value = post.key;
        document.getElementById("post-headlinex").value = post.headline;
        document.getElementById("post-teaser").value = post.teaser;
        document.getElementById("post-content").value = post.content;
        document.getElementById("post-date").value = post.date || "";

        // Display the current image filename
        const currentImageElement = document.getElementById("current-image");
        currentImageElement.textContent = `Current Image: ${post.image || "None"}`;

        // Set the form to edit mode
        const form = document.getElementById("new-post-form");
        form.dataset.editing = "true";

        setupPostForm();
      }
    }






    function deletePost(postKey) {
      if (confirm("Delete this post?")) {
        CRUD.deletePost(postKey);
        renderPosts();
      }
    }


    function hideForm() {
      const formContainer = document.querySelector(".input-form");
      if (formContainer) {
        formContainer.style.display = "none"; // Hide the form
      }
    }



    function downloadPosts() {
      const posts = CRUD.getAllPosts();
      const data = JSON.stringify(posts, null, 2);
      const blob = new Blob([data], { type: "application/json" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "blog-posts.json";
      a.click();
      URL.revokeObjectURL(url);
    }

    function uploadPosts() {
      const input = document.createElement("input");
      input.type = "file";
      input.accept = ".json";
      input.onchange = (e) => {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = (event) => {
            try {
              const posts = JSON.parse(event.target.result);
              posts.forEach((post) => {
                if (!CRUD.retrievePost(post.key)) {
                  CRUD.createPost(post.key, post);
                }
              });
              renderPosts();
              alert("Posts uploaded successfully!");
            } catch (e) {
              console.error("Error uploading posts:", e);
              alert("Failed to upload posts. Please check the JSON format.");
            }
          };
          reader.readAsText(file);
        }
      };
      input.click();
    }

    document.addEventListener("DOMContentLoaded", () => {
      const form = document.getElementById("new-post-form");

    });

   


  </script>
</head>

<body class="w3-theme-l5">

  <div id="custom-alert" class="alert"  onclick="document.getElementById('custom-alert').style.display='none'">
    <span id="alert-message"></span>
 
  </div>


  <!-- Page Container -->
  <div class="w3-container w3-content" style="max-width:1400px;margin-top:10px;padding:0px;">
    <!-- The Grid -->
    <div class="w3-row" style="padding:0px">
      <!-- Left Column -->
      <div class="w3-col m2">
        <!-- Profile -->
        <div class="w3-card w3-round w3-white">
          <div class="w3-container">
            <h4 class="w3-center">v1.11 - 8 may 2025</h4>
            <p class="w3-center"><img src="https://w3schools.com/w3images/avatar3.png" class="w3-circle"
                style="height:106px;width:106px" alt="Profile picture"></p>
            <hr>
            <p><i class="fa fa-pencil fa-fw w3-margin-right w3-text-theme"></i> Designer, UI</p>
            <p><i class="fa fa-home fa-fw w3-margin-right w3-text-theme"></i> London, UK</p>
            <p><i class="fa fa-birthday-cake fa-fw w3-margin-right w3-text-theme"></i> April 1, 1988</p>
          </div>
        </div>
        <br>


        <br>



      </div>

      <!-- Middle Column -->
      <div class="w3-col m7" style="padding:0px;">
        <div>
          <div class="w3-col m12" style="padding:0px;margin-left:0px;margin-right:0px;">
            <div class="w3-card w3-round w3-white">
              <div class="w3-container">
                <div style="text-align:center">
                  <h1>BLOGGING FOR FUN</h1>
                </div>
                <div class="w3-container w3-card W3-FloralWhite w3-round w3-margin"
                  style="margin-bottom:10px;padding:0px">
                  <br>
                  <div class="w3-container w3-sans-serif post-container">
                    <div class="w3-card-4 post-header"
                      style="width:100%;height:200px;margin-bottom:20px;border-radius: 5px;">
                      <header class="w3-container w3-light-grey">
                        <h3>Welcome</h3>
                      </header>
                      <div class="w3-container">
                        <img src="images/blogging.jpg" alt="Author's profile picture" class="w3-left w3-margin-right"
                          style="width:150px;margin-bottom:10px">
                        <h6>No one seems to blog for fun nowadays.</h6><br>
                      </div>

                    </div>
                    <div class="content w3-justify">
                      <p>It seems that the world has moved on to other things, like TikTok, Instagram, and other social
                        media. I remember when I first started blogging, it was a way to express myself and share my
                        thoughts with the world. Now it seems that everyone is more interested in short videos and
                        pictures than in reading long posts.</p>
                      <p>But I still love blogging. It allows me to think deeply about topics that interest me and share
                        my ideas with others. I hope that one day people will return to blogging for fun, but until
                        then, I will continue to write for myself.</p>
                    </div>
                  </div>



                  <div class="w3-container input-form" style="padding: 10px;">
                    <h3 id="editType">Create New Post</h3>
                    <form id="new-post-form" class="w3-form">
                      <label for="post-key">Post Key (unique ID)</label>
                      <input type="text" id="post-key" class="w3-input w3-margin-bottom" placeholder="e.g., post-123"
                        required aria-describedby="post-key-error">
                      <span id="post-key-error" class="w3-text-red" style="display:none;">Key must be unique.</span>
                      <label for="post-headlinex">Headline</label>
                      <input type="text" id="post-headlinex" class="w3-input w3-margin-bottom"
                        placeholder="Post Headline" required>
                      <label for="post-teaser">Teaser</label>
                      <input type="text" id="post-teaser" class="w3-input w3-margin-bottom"
                        placeholder="Short teaser text" required>
                      <label for="post-content">Content</label>
                      <textarea id="post-content" class="w3-input w3-margin-bottom"
                        placeholder="Post content (supports HTML)" rows="5" required></textarea>
                      <label for="post-imagex">Image (optional)</label>
                      <input type="file" id="post-imagex" class="w3-input w3-margin-bottom" accept="image/*">
                      <p id="current-image" class="w3-text-grey">Current Image: None</p>
                      <label for="post-date">Date (optional, defaults to today)</label>
                      <input type="date" id="post-date" class="w3-input w3-margin-bottom">
                      <button type="submit" class="w3-button w3-theme-d2">Save Post</button>

                      <!-- New button to hide the form -->
                      <button type="button" class="w3-button w3-theme-l4 w3-right" onclick="hideForm()">Cancel</button>


                    </form>
                  </div>

                  <script>
                    const postKey = document.getElementById("post-key");
                    //      postKey.value = Date.now();
                    postKey.readOnly = true; // Make the key read-only
                    postKey.addEventListener("focus", function () {
                      this.blur(); // Prevents the user from focusing on the input field
                    });

                  </script>

                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Right Column -->
      <div class="w3-col m3">
        <div class="w3-card w3-round w3-white w3-center">
          <div class="w3-container">
            <div class="w3-card w3-round w3-white w3-center">
              <div class="w3-container">

                <!-- Add the Create New Post button -->
                <button class="w3-button w3-theme-d2 w3-margin-top w3-margin-bottom" onclick="renderPosts()">Show All
                  Posts</button>
                <button class="w3-button w3-theme-d2 w3-margin-bottom admin" onclick="setupPostForm()">Create New
                  Post</button>
                <div id="side-menu" style="overflow:auto;height:400px"></div>
              </div>
            </div>
            <p>That's all folks</p>

            <!-- tags-->
            <div class="w3-card w3-round w3-white w3-hide-small">
              <div class="w3-container">
                <p>hashtags</p>
                <p>

                  <span class="w3-tag w3-small w3-theme-d5">News</span>
                  <span class="w3-tag w3-small w3-theme-d4">W3Schools</span>
                  <span class="w3-tag w3-small w3-theme-d3">Labels</span>
                  <span class="w3-tag w3-small w3-theme-d2">Games</span>
                  <span class="w3-tag w3-small w3-theme-d1">Friends</span>
                  <span class="w3-tag w3-small w3-theme">Games</span>
                  <span class="w3-tag w3-small w3-theme-l1">Friends</span>
                  <span class="w3-tag w3-small w3-theme-l2">Food</span>
                  <span class="w3-tag w3-small w3-theme-l3">Design</span>
                  <span class="w3-tag w3-small w3-theme-l4">Art</span>
                  <span class="w3-tag w3-small w3-theme-l5">Photos</span>
                </p>
              </div>
            </div>
            <br>




            <div id="side-menu"></div>
          </div>
        </div>
        <br>
        <div class="w3-card w3-round w3-white w3-center admin">

          <div class="w3-container">
            <p>Storage Operations</p>

            <div class="w3-card w3-round w3-white w3-center">
              <div class="w3-container">

                <p><button onclick="CRUD.deleteAllPosts()" class="w3-button w3-block w3-theme-l4">Clear Storage</button>
                </p>
                <p><button onclick="downloadPosts()" class="w3-button w3-block w3-theme-l4">Download Posts</button></p>
                <p><button onclick="uploadPosts()" class="w3-button w3-block w3-theme-l4">Upload Posts</button></p>
              </div>
            </div>

          </div>





        </div>
        <br>
        <br>
      </div>
    </div>
  </div>


  <footer class="w3-container" style="background-color:orange;padding:0px;text-align: center;">

    <h6 style="color:white">Template by w3.css&nbsp;&nbsp;powered by cloudflare</h6>
    </p>
  </footer>

  <script>
    /* Accordion
    function myFunction(id) {
      var x = document.getElementById(id);
      if (x.className.indexOf("w3-show") == -1) {
        x.className += " w3-show";
        x.previousElementSibling.className += " w3-theme-d1";
      } else {
        x.className = x.className.replace("w3-show", "");
        x.previousElementSibling.className = x.previousElementSibling.className.replace(" w3-theme-d1", "");
      }
    }
*/
    // Used to toggle the menu on smaller screens when clicking on the menu button
    function openNav() {
      var x = document.getElementById("navDemo");
      if (x.className.indexOf("w3-show") == -1) {
        x.className += " w3-show";
      } else {
        x.className = x.className.replace(" w3-show", "");
      }
    }
  </script>
</body>

</html>